import{_ as e,c as t,a as n,e as o,b as a,d as r,w as l,r as c,o as i}from"./app-CdUme-sL.js";const u={};function k(d,s){const p=c("RouteLink");return i(),t("div",null,[s[7]||(s[7]=n("h1",{id:"models",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#models"},[n("span",null,"Models")])],-1)),n("p",null,[s[1]||(s[1]=a("Models are defined with ")),s[2]||(s[2]=n("strong",null,"definition.model({ name, properties, indexes, ... })",-1)),s[3]||(s[3]=a(". They define the shape of stored entities and optional indexes for range/list queries. This section describes ")),s[4]||(s[4]=n("strong",null,"bare models",-1)),s[5]||(s[5]=a(" only; ownership and relations (userProperty, itemOf, sessionOrUserProperty, etc.) are described in ")),r(p,{to:"/server/09-relations.html"},{default:l(()=>s[0]||(s[0]=[a("Relations")])),_:1,__:[0]}),s[6]||(s[6]=a("."))]),s[8]||(s[8]=o(`<h2 id="bare-model-with-entity-access-event" tabindex="-1"><a class="header-anchor" href="#bare-model-with-entity-access-event"><span>Bare model with entity access (Event)</span></a></h2><p>Global entity with role-based access (no per-user “owner” field):</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code><span class="line"><span class="token comment">// Source: speed-dating/server/speed-dating-service/event.js (excerpt)</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">const</span> Event <span class="token operator">=</span> definition<span class="token punctuation">.</span><span class="token function">model</span><span class="token punctuation">(</span><span class="token punctuation">{</span></span>
<span class="line">  <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&quot;Event&quot;</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token literal-property property">entity</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token literal-property property">writeAccessControl</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">roles</span><span class="token operator">:</span> adminRoles <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token literal-property property">readAccessControl</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">roles</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">}</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token literal-property property">properties</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">type</span><span class="token operator">:</span> String<span class="token punctuation">,</span> <span class="token literal-property property">softValidation</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&#39;nonEmpty&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&#39;maxLength&#39;</span><span class="token punctuation">,</span> <span class="token literal-property property">length</span><span class="token operator">:</span> <span class="token number">128</span> <span class="token punctuation">}</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token literal-property property">description</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">type</span><span class="token operator">:</span> String<span class="token punctuation">,</span> <span class="token literal-property property">input</span><span class="token operator">:</span> <span class="token string">&#39;textarea&#39;</span><span class="token punctuation">,</span> <span class="token operator">...</span> <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token literal-property property">startTime</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">type</span><span class="token operator">:</span> Date<span class="token punctuation">,</span> <span class="token function-variable function">default</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span>Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1000</span> <span class="token operator">*</span> <span class="token number">60</span> <span class="token operator">*</span> <span class="token number">60</span> <span class="token operator">*</span> <span class="token number">24</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token literal-property property">input</span><span class="token operator">:</span> <span class="token string">&#39;datetime&#39;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token literal-property property">autoStart</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">type</span><span class="token operator">:</span> Boolean<span class="token punctuation">,</span> <span class="token keyword">default</span><span class="token operator">:</span> <span class="token boolean">false</span> <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token literal-property property">phases</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token literal-property property">type</span><span class="token operator">:</span> Array<span class="token punctuation">,</span></span>
<span class="line">      <span class="token keyword">of</span><span class="token operator">:</span> phaseType<span class="token punctuation">,</span></span>
<span class="line">      <span class="token function-variable function">default</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>defaultPhases<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">      <span class="token literal-property property">softValidation</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&#39;nonEmpty&#39;</span><span class="token punctuation">]</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token literal-property property">hubCoopAuthenticationSupport</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">type</span><span class="token operator">:</span> Boolean<span class="token punctuation">,</span> <span class="token keyword">default</span><span class="token operator">:</span> <span class="token boolean">false</span> <span class="token punctuation">}</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token literal-property property">indexes</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token literal-property property">byStartTime</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">property</span><span class="token operator">:</span> <span class="token string">&#39;startTime&#39;</span> <span class="token punctuation">}</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="bare-model-with-properties-and-indexes-transaction" tabindex="-1"><a class="header-anchor" href="#bare-model-with-properties-and-indexes-transaction"><span>Bare model with properties and indexes (Transaction)</span></a></h2><p>No ownership annotation; indexes for lookups and ranges:</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code><span class="line"><span class="token comment">// Source: ipi-web/scan/server/scan-service/model.js (excerpt)</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">const</span> Transaction <span class="token operator">=</span> definition<span class="token punctuation">.</span><span class="token function">model</span><span class="token punctuation">(</span><span class="token punctuation">{</span></span>
<span class="line">  <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&#39;Transaction&#39;</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token literal-property property">properties</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token literal-property property">height</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">type</span><span class="token operator">:</span> Number <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token literal-property property">time</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">type</span><span class="token operator">:</span> Date <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token literal-property property">hash</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">type</span><span class="token operator">:</span> String <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token literal-property property">gasUsed</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">type</span><span class="token operator">:</span> Number <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token literal-property property">events</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">type</span><span class="token operator">:</span> Array<span class="token punctuation">,</span> <span class="token keyword">of</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">type</span><span class="token operator">:</span> Object<span class="token punctuation">,</span> <span class="token literal-property property">properties</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">type</span><span class="token operator">:</span> String <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token literal-property property">attributes</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">type</span><span class="token operator">:</span> Object <span class="token punctuation">}</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token literal-property property">inputs</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">type</span><span class="token operator">:</span> Array<span class="token punctuation">,</span> <span class="token keyword">of</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">type</span><span class="token operator">:</span> Object<span class="token punctuation">,</span> <span class="token literal-property property">properties</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">address</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">type</span><span class="token operator">:</span> String <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token literal-property property">amount</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">type</span><span class="token operator">:</span> String <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token literal-property property">denom</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">type</span><span class="token operator">:</span> String <span class="token punctuation">}</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token literal-property property">outputs</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">type</span><span class="token operator">:</span> Array<span class="token punctuation">,</span> <span class="token keyword">of</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token operator">...</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token literal-property property">participants</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">type</span><span class="token operator">:</span> Array<span class="token punctuation">,</span> <span class="token keyword">of</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">type</span><span class="token operator">:</span> String <span class="token punctuation">}</span> <span class="token punctuation">}</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token literal-property property">indexes</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token literal-property property">byTime</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">property</span><span class="token operator">:</span> <span class="token string">&#39;time&#39;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token literal-property property">byHash</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">property</span><span class="token operator">:</span> <span class="token string">&#39;hash&#39;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token literal-property property">byParticipants</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">property</span><span class="token operator">:</span> <span class="token string">&#39;participants&#39;</span><span class="token punctuation">,</span> <span class="token literal-property property">multi</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="convention-objecttype-and-object" tabindex="-1"><a class="header-anchor" href="#convention-objecttype-and-object"><span>Convention: objectType and object</span></a></h2><p>When referring to another entity (e.g. in access control, triggers, or payloads), the framework and services often use a pair of fields:</p><ul><li><strong>objectType</strong> — The type of the object, usually as <code>serviceName_ModelName</code> (e.g. <code>billing_TopUp</code>, <code>user_User</code>, <code>speedDating_Event</code>).</li><li><strong>object</strong> — The id of that object.</li></ul><p>Example in view accessControl:</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code><span class="line"><span class="token comment">// Source: live-change-stack/services/billing-service/topUp.js</span></span>
<span class="line"></span>
<span class="line"><span class="token literal-property property">accessControl</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token literal-property property">roles</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&#39;owner&#39;</span><span class="token punctuation">]</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token function-variable function">objects</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">[</span><span class="token punctuation">{</span></span>
<span class="line">    <span class="token literal-property property">objectType</span><span class="token operator">:</span> definition<span class="token punctuation">.</span>name <span class="token operator">+</span> <span class="token string">&#39;_TopUp&#39;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token literal-property property">object</span><span class="token operator">:</span> props<span class="token punctuation">.</span>topUp</span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">]</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Example in trigger payload (causeType / cause):</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code><span class="line"><span class="token literal-property property">causeType</span><span class="token operator">:</span> <span class="token string">&#39;billing_TopUp&#39;</span><span class="token punctuation">,</span></span>
<span class="line"><span class="token literal-property property">cause</span><span class="token operator">:</span> topUp<span class="token punctuation">.</span>id</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>The same pattern appears as <strong>ownerType</strong> / <strong>owner</strong>, <strong>causeType</strong> / <strong>cause</strong>, <strong>sessionOrUserType</strong> / <strong>sessionOrUser</strong>, etc.: one field holds the type name, the other the id. Use <strong>App.encodeIdentifier([type, id])</strong> when you need a single composite key (e.g. for path or id).</p><h2 id="property-options" tabindex="-1"><a class="header-anchor" href="#property-options"><span>Property options</span></a></h2><ul><li><strong>type</strong> — String, Number, Boolean, Date, Object, Array, or custom (e.g. &#39;Image&#39;). For polymorphic references use <code>type: &#39;type&#39;</code> and <code>type: &#39;any&#39;</code> (type name + id).</li><li><strong>validation</strong> / <strong>softValidation</strong> — e.g. <code>[&#39;nonEmpty&#39;]</code>, <code>{ name: &#39;maxLength&#39;, length: 80 }</code>, <code>[&#39;integer&#39;]</code>.</li><li><strong>default</strong> — Static value or function <code>() =&gt; value</code>.</li><li><strong>options</strong> — Allowed values for enums.</li><li><strong>if</strong> — Conditional visibility (e.g. <code>App.isomorphic(() =&gt; ...)</code> for dependent fields).</li><li><strong>updated</strong> — Function returning new value on update (e.g. <code>stateUpdatedAt: { type: Date, updated: () =&gt; new Date() }</code>).</li></ul><h2 id="indexes" tabindex="-1"><a class="header-anchor" href="#indexes"><span>Indexes</span></a></h2><ul><li><strong>property</strong> — Single key (string) or array of keys for composite index.</li><li><strong>multi</strong> — If true, one record can appear under multiple index keys (e.g. array property like participants).</li></ul>`,18))])}const m=e(u,[["render",k]]),v=JSON.parse('{"path":"/server/05-models.html","title":"Models","lang":"en-US","frontmatter":{"title":"Models"},"headers":[{"level":2,"title":"Bare model with entity access (Event)","slug":"bare-model-with-entity-access-event","link":"#bare-model-with-entity-access-event","children":[]},{"level":2,"title":"Bare model with properties and indexes (Transaction)","slug":"bare-model-with-properties-and-indexes-transaction","link":"#bare-model-with-properties-and-indexes-transaction","children":[]},{"level":2,"title":"Convention: objectType and object","slug":"convention-objecttype-and-object","link":"#convention-objecttype-and-object","children":[]},{"level":2,"title":"Property options","slug":"property-options","link":"#property-options","children":[]},{"level":2,"title":"Indexes","slug":"indexes","link":"#indexes","children":[]}],"git":{"updatedTime":1771163669000,"contributors":[{"name":"Michał Łaszczewski","username":"","email":"michal@laszczewski.com","commits":1}],"changelog":[{"hash":"cfc969ff1ce8a43846182cb1c9818f3c88cd885a","time":1771163669000,"email":"michal@laszczewski.com","author":"Michał Łaszczewski","message":"docs"}]},"filePathRelative":"server/05-models.md"}');export{m as comp,v as data};
