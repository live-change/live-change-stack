import{_ as n,c as a,e as p,o as e}from"./app-CdUme-sL.js";const t={};function o(l,s){return e(),a("div",null,s[0]||(s[0]=[p(`<h1 id="security-and-access" tabindex="-1"><a class="header-anchor" href="#security-and-access"><span>Security and access</span></a></h1><p>Access control is enforced at multiple layers: <strong>view/action accessControl</strong>, <strong>model/userProperty/sessionOrUserProperty/entity</strong> roles, <strong>relations plugin</strong> (readAccessControl, writeAccessControl on propertyOf/itemOf), and <strong>security.config</strong> for rate-limiting and bans (e.g. wrong secret code).</p><h2 id="view-accesscontrol-roles-and-objects" tabindex="-1"><a class="header-anchor" href="#view-accesscontrol-roles-and-objects"><span>View accessControl (roles and objects)</span></a></h2><p>Restrict who can call a view (or action) by roles and/or by object-level access (accessControl service):</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code><span class="line"><span class="token comment">// Source: live-change-stack/services/billing-service/topUp.js</span></span>
<span class="line"></span>
<span class="line">definition<span class="token punctuation">.</span><span class="token function">view</span><span class="token punctuation">(</span><span class="token punctuation">{</span></span>
<span class="line">  <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&quot;topUp&quot;</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token literal-property property">properties</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">topUp</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">type</span><span class="token operator">:</span> TopUp <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token literal-property property">returns</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">type</span><span class="token operator">:</span> TopUp <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token literal-property property">accessControl</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token literal-property property">roles</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&#39;owner&#39;</span><span class="token punctuation">]</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token function-variable function">objects</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">[</span><span class="token punctuation">{</span></span>
<span class="line">      <span class="token literal-property property">objectType</span><span class="token operator">:</span> definition<span class="token punctuation">.</span>name <span class="token operator">+</span> <span class="token string">&#39;_TopUp&#39;</span><span class="token punctuation">,</span></span>
<span class="line">      <span class="token literal-property property">object</span><span class="token operator">:</span> props<span class="token punctuation">.</span>topUp</span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">]</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token keyword">async</span> <span class="token function">daoPath</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> topUp <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> client<span class="token punctuation">,</span> service <span class="token punctuation">}</span><span class="token punctuation">,</span> method</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">return</span> TopUp<span class="token punctuation">.</span><span class="token function">path</span><span class="token punctuation">(</span>topUp<span class="token punctuation">)</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>So only users with role <strong>owner</strong> for the given TopUp object can read it.</p><h2 id="model-access-userproperty-entity" tabindex="-1"><a class="header-anchor" href="#model-access-userproperty-entity"><span>Model access (userProperty, entity)</span></a></h2><ul><li><strong>userProperty</strong> — One record per user; <strong>userReadAccess</strong> / <strong>readAccessControl</strong> (roles like &#39;owner&#39;, &#39;admin&#39;) control who can read.</li><li><strong>entity</strong> — Global entity with <strong>writeAccessControl</strong> / <strong>readAccessControl</strong> (roles):</li></ul><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code><span class="line"><span class="token comment">// Source: live-change-stack/services/billing-service/billing.js</span></span>
<span class="line"></span>
<span class="line"><span class="token literal-property property">userProperty</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token function-variable function">userReadAccess</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token boolean">true</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token literal-property property">readAccessControl</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">roles</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&#39;owner&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;admin&#39;</span><span class="token punctuation">]</span> <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code><span class="line"><span class="token comment">// Source: speed-dating/server/speed-dating-service/event.js</span></span>
<span class="line"></span>
<span class="line"><span class="token literal-property property">entity</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token literal-property property">writeAccessControl</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">roles</span><span class="token operator">:</span> adminRoles <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token literal-property property">readAccessControl</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">roles</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="relation-access-itemof-propertyof" tabindex="-1"><a class="header-anchor" href="#relation-access-itemof-propertyof"><span>Relation access (itemOf, propertyOf)</span></a></h2><p>Relations plugin uses <strong>readAccessControl</strong> / <strong>writeAccessControl</strong> on the relation config so that access to items/properties follows the parent or role:</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code><span class="line"><span class="token comment">// Source: live-change-stack/services/billing-service/topUp.js</span></span>
<span class="line"></span>
<span class="line"><span class="token literal-property property">itemOf</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token literal-property property">what</span><span class="token operator">:</span> Billing<span class="token punctuation">,</span></span>
<span class="line">  <span class="token literal-property property">readAccessControl</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">roles</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&#39;owner&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;admin&#39;</span><span class="token punctuation">]</span> <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="security-config-rate-limits-and-bans" tabindex="-1"><a class="header-anchor" href="#security-config-rate-limits-and-bans"><span>security.config (rate limits and bans)</span></a></h2><p>Apps often use a <strong>security.config.js</strong> that defines <strong>clientKeys</strong>, <strong>patterns</strong>, and <strong>counters</strong> for the security/pattern service (e.g. @live-change/pattern). Counters can trigger bans (e.g. captcha or block) after N failed attempts per key (e.g. IP) in a time window:</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code><span class="line"><span class="token comment">// Source: speed-dating/server/security.config.js</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">import</span> lcp <span class="token keyword">from</span> <span class="token string">&quot;@live-change/pattern&quot;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">const</span> <span class="token function-variable function">clientKeys</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">client</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">[</span></span>
<span class="line">  <span class="token punctuation">{</span> <span class="token literal-property property">key</span><span class="token operator">:</span> <span class="token string">&#39;user&#39;</span><span class="token punctuation">,</span> <span class="token literal-property property">value</span><span class="token operator">:</span> client<span class="token punctuation">.</span>user <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token punctuation">{</span> <span class="token literal-property property">key</span><span class="token operator">:</span> <span class="token string">&#39;session&#39;</span><span class="token punctuation">,</span> <span class="token literal-property property">value</span><span class="token operator">:</span> client<span class="token punctuation">.</span>session <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token punctuation">{</span> <span class="token literal-property property">key</span><span class="token operator">:</span> <span class="token string">&#39;ip&#39;</span><span class="token punctuation">,</span> <span class="token literal-property property">value</span><span class="token operator">:</span> client<span class="token punctuation">.</span>ip <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">]</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">const</span> counters <span class="token operator">=</span> <span class="token punctuation">[</span></span>
<span class="line">  <span class="token punctuation">{</span></span>
<span class="line">    <span class="token literal-property property">id</span><span class="token operator">:</span> <span class="token string">&#39;wrong-codes-captcha&#39;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token literal-property property">match</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&#39;wrong-secret-code&#39;</span><span class="token punctuation">]</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token literal-property property">keys</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&#39;ip&#39;</span><span class="token punctuation">]</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token literal-property property">max</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token literal-property property">duration</span><span class="token operator">:</span> <span class="token string">&#39;1m&#39;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token literal-property property">actions</span><span class="token operator">:</span> <span class="token punctuation">[</span></span>
<span class="line">      <span class="token punctuation">{</span> <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&#39;ban&#39;</span><span class="token punctuation">,</span> <span class="token literal-property property">keys</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&#39;ip&#39;</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token literal-property property">ban</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&#39;captcha&#39;</span><span class="token punctuation">,</span> <span class="token literal-property property">actions</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&#39;checkSecretCode&#39;</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token literal-property property">expire</span><span class="token operator">:</span> <span class="token string">&quot;30m&quot;</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">]</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token punctuation">{</span></span>
<span class="line">    <span class="token literal-property property">id</span><span class="token operator">:</span> <span class="token string">&#39;wrong-codes-ban&#39;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token literal-property property">visible</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token literal-property property">match</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&#39;wrong-secret-code&#39;</span><span class="token punctuation">]</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token literal-property property">keys</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&#39;ip&#39;</span><span class="token punctuation">]</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token literal-property property">max</span><span class="token operator">:</span> <span class="token number">5</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token literal-property property">duration</span><span class="token operator">:</span> <span class="token string">&#39;10m&#39;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token literal-property property">actions</span><span class="token operator">:</span> <span class="token punctuation">[</span></span>
<span class="line">      <span class="token punctuation">{</span> <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&#39;ban&#39;</span><span class="token punctuation">,</span> <span class="token literal-property property">keys</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&#39;ip&#39;</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token literal-property property">ban</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&#39;block&#39;</span><span class="token punctuation">,</span> <span class="token literal-property property">actions</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&#39;checkSecretCode&#39;</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token literal-property property">expire</span><span class="token operator">:</span> <span class="token string">&quot;2m&quot;</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">]</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">]</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span></span>
<span class="line">  clientKeys<span class="token punctuation">,</span></span>
<span class="line">  patterns<span class="token punctuation">,</span></span>
<span class="line">  counters</span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>This is passed into app.config as <strong>security: { ...securityConfig }</strong> so the security service can enforce limits and bans on actions (e.g. checkSecretCode).</p>`,17)]))}const r=n(t,[["render",o]]),i=JSON.parse('{"path":"/server/12-security-and-access.html","title":"Security and access","lang":"en-US","frontmatter":{"title":"Security and access"},"headers":[{"level":2,"title":"View accessControl (roles and objects)","slug":"view-accesscontrol-roles-and-objects","link":"#view-accesscontrol-roles-and-objects","children":[]},{"level":2,"title":"Model access (userProperty, entity)","slug":"model-access-userproperty-entity","link":"#model-access-userproperty-entity","children":[]},{"level":2,"title":"Relation access (itemOf, propertyOf)","slug":"relation-access-itemof-propertyof","link":"#relation-access-itemof-propertyof","children":[]},{"level":2,"title":"security.config (rate limits and bans)","slug":"security-config-rate-limits-and-bans","link":"#security-config-rate-limits-and-bans","children":[]}],"git":{"updatedTime":1771163669000,"contributors":[{"name":"Michał Łaszczewski","username":"","email":"michal@laszczewski.com","commits":1}],"changelog":[{"hash":"cfc969ff1ce8a43846182cb1c9818f3c88cd885a","time":1771163669000,"email":"michal@laszczewski.com","author":"Michał Łaszczewski","message":"docs"}]},"filePathRelative":"server/12-security-and-access.md"}');export{r as comp,i as data};
