import{_ as n,c as a,e,o as t}from"./app-CdUme-sL.js";const p={};function o(r,s){return t(),a("div",null,s[0]||(s[0]=[e(`<h1 id="sessionoruserproperty-and-sessionoruseritem" tabindex="-1"><a class="header-anchor" href="#sessionoruserproperty-and-sessionoruseritem"><span>sessionOrUserProperty and sessionOrUserItem</span></a></h1><p>From <strong>user service</strong> (<code>use: [ userService ]</code>). The owner is either a <strong>Session</strong> or a <strong>User</strong>. Useful for data created before login (session) that can later be transferred to the user on sign-in. A processor turns <strong>sessionOrUserProperty</strong> / <strong>sessionOrUserItem</strong> into <strong>propertyOfAny</strong> / <strong>itemOfAny</strong> with <strong>to: [&#39;sessionOrUser&#39;, ...extendedWith]</strong> and <strong>sessionOrUserTypes: [&#39;session_Session&#39;, &#39;user_User&#39;]</strong>, then adds views and actions and a <strong>signedIn</strong> trigger to transfer or merge session data to the user.</p><h2 id="sessionoruserproperty" tabindex="-1"><a class="header-anchor" href="#sessionoruserproperty"><span>sessionOrUserProperty</span></a></h2><p>One record per session-or-user (and optionally per extra dimensions from <strong>extendedWith</strong>). The processor adds:</p><ul><li><strong>my&lt;ModelName&gt;</strong> — Single property for current client (session or user), optionally with extra params for extendedWith.</li><li><strong>my&lt;Xxx&gt;&lt;ModelName&gt;s</strong> — Range views when <strong>extendedWith</strong> is used (e.g. myGiverReceivedCards).</li><li>Actions <strong>setMy&lt;ModelName&gt;</strong> (Set), <strong>updateMy&lt;ModelName&gt;</strong> (Update), <strong>setOrUpdateMy&lt;ModelName&gt;</strong> (Set or update), <strong>resetMy&lt;ModelName&gt;</strong> (Reset).</li></ul><p>On <strong>signedIn</strong>, session properties can be <strong>transferred</strong> to the user or <strong>merged</strong> (if <strong>merge</strong> and optionally <strong>mergeWithoutDelete</strong> are set).</p><h3 id="configuration" tabindex="-1"><a class="header-anchor" href="#configuration"><span>Configuration</span></a></h3><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code><span class="line">model<span class="token punctuation">.</span>sessionOrUserProperty <span class="token operator">=</span> <span class="token punctuation">{</span></span>
<span class="line">  extendedWith<span class="token operator">?</span><span class="token operator">:</span> string <span class="token operator">|</span> string<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>   <span class="token comment">// e.g. [&#39;giver&#39;] → sessionOrUserType, sessionOrUser, giverType, giver</span></span>
<span class="line">  ownerReadAccess<span class="token operator">?</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">params<span class="token punctuation">,</span> context</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> boolean<span class="token punctuation">,</span></span>
<span class="line">  ownerSetAccess<span class="token operator">?</span><span class="token operator">:</span> AccessSpecification<span class="token punctuation">,</span></span>
<span class="line">  ownerUpdateAccess<span class="token operator">?</span><span class="token operator">:</span> AccessSpecification<span class="token punctuation">,</span></span>
<span class="line">  ownerResetAccess<span class="token operator">?</span><span class="token operator">:</span> AccessSpecification<span class="token punctuation">,</span></span>
<span class="line">  ownerWriteAccess<span class="token operator">?</span><span class="token operator">:</span> AccessSpecification<span class="token punctuation">,</span></span>
<span class="line">  writeableProperties<span class="token operator">?</span><span class="token operator">:</span> string<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span></span>
<span class="line">  merge<span class="token operator">?</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">sessionProperty<span class="token punctuation">,</span> userProperty</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> mergedData <span class="token operator">|</span> <span class="token keyword">null</span><span class="token punctuation">,</span>  <span class="token comment">// on sign-in</span></span>
<span class="line">  mergeWithoutDelete<span class="token operator">?</span><span class="token operator">:</span> boolean<span class="token punctuation">,</span></span>
<span class="line">  ownerViews<span class="token operator">?</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span> name<span class="token operator">?</span><span class="token punctuation">,</span> access<span class="token operator">?</span><span class="token punctuation">,</span> fields<span class="token operator">?</span> <span class="token punctuation">}</span><span class="token punctuation">]</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="sessionoruseritem" tabindex="-1"><a class="header-anchor" href="#sessionoruseritem"><span>sessionOrUserItem</span></a></h2><p>Many records per session-or-user. The processor adds:</p><ul><li><strong>my&lt;ModelName&gt;s</strong> (plural) — Range of items for current session/user.</li><li><strong>mySessionOrUser&lt;ModelName&gt;sBy&lt;SortField&gt;</strong> when <strong>sortBy</strong> is set.</li><li><strong>my&lt;ModelName&gt;</strong> — Single item by id (ownership check).</li><li>Actions <strong>createMy&lt;ModelName&gt;</strong> (Create), <strong>updateMy&lt;ModelName&gt;</strong> (Update), <strong>deleteMyUser&lt;ModelName&gt;</strong> (Delete).</li></ul><p>On <strong>signedIn</strong>, session items can be <strong>transferred</strong> to the user or <strong>merged</strong> (if <strong>merge</strong> returns { transferred, updated, deleted }).</p><h3 id="configuration-1" tabindex="-1"><a class="header-anchor" href="#configuration-1"><span>Configuration</span></a></h3><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code><span class="line">model<span class="token punctuation">.</span>sessionOrUserItem <span class="token operator">=</span> <span class="token punctuation">{</span></span>
<span class="line">  extendedWith<span class="token operator">?</span><span class="token operator">:</span> string <span class="token operator">|</span> string<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span></span>
<span class="line">  ownerReadAccess<span class="token operator">?</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">params<span class="token punctuation">,</span> context</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> boolean<span class="token punctuation">,</span></span>
<span class="line">  ownerCreateAccess<span class="token operator">?</span><span class="token operator">:</span> AccessSpecification<span class="token punctuation">,</span></span>
<span class="line">  ownerUpdateAccess<span class="token operator">?</span><span class="token operator">:</span> AccessSpecification<span class="token punctuation">,</span></span>
<span class="line">  ownerWriteAccess<span class="token operator">?</span><span class="token operator">:</span> AccessSpecification<span class="token punctuation">,</span></span>
<span class="line">  userDeleteAccess<span class="token operator">?</span><span class="token operator">:</span> AccessSpecification<span class="token punctuation">,</span></span>
<span class="line">  writableProperties<span class="token operator">?</span><span class="token operator">:</span> string<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span></span>
<span class="line">  sortBy<span class="token operator">?</span><span class="token operator">:</span> string<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span></span>
<span class="line">  merge<span class="token operator">?</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">sessionItems<span class="token punctuation">,</span> userItems</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> transferred<span class="token operator">?</span><span class="token punctuation">,</span> updated<span class="token operator">?</span><span class="token punctuation">,</span> deleted<span class="token operator">?</span> <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="example-receivedcard-sessionoruserproperty-with-extendedwith" tabindex="-1"><a class="header-anchor" href="#example-receivedcard-sessionoruserproperty-with-extendedwith"><span>Example: ReceivedCard (sessionOrUserProperty with extendedWith)</span></a></h2><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code><span class="line"><span class="token comment">// Source: speed-dating/server/business-card-service/card.js</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">const</span> ReceivedCard <span class="token operator">=</span> definition<span class="token punctuation">.</span><span class="token function">model</span><span class="token punctuation">(</span><span class="token punctuation">{</span></span>
<span class="line">  <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&quot;ReceivedCard&quot;</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token literal-property property">sessionOrUserProperty</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token literal-property property">extendedWith</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&#39;giver&#39;</span><span class="token punctuation">]</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token function-variable function">ownerReadAccess</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token boolean">true</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token function-variable function">ownerUpdateAccess</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token boolean">true</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token function-variable function">ownerResetAccess</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token boolean">true</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token function-variable function">singleAccess</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token boolean">true</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token literal-property property">properties</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token literal-property property">state</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">type</span><span class="token operator">:</span> String<span class="token punctuation">,</span> <span class="token keyword">default</span><span class="token operator">:</span> <span class="token string">&#39;received&#39;</span><span class="token punctuation">,</span> <span class="token literal-property property">validation</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&#39;nonEmpty&#39;</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token literal-property property">options</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&#39;received&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;accepted&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;rejected&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;blocked&#39;</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token literal-property property">givenAt</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">type</span><span class="token operator">:</span> Date<span class="token punctuation">,</span> <span class="token function-variable function">default</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token literal-property property">stateUpdatedAt</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">type</span><span class="token operator">:</span> Date<span class="token punctuation">,</span> <span class="token function-variable function">updated</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token literal-property property">givenInType</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&#39;type&#39;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token literal-property property">givenIn</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&#39;any&#39;</span> <span class="token punctuation">}</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token literal-property property">indexes</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token literal-property property">byOwnerAndStateAndTime</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">property</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&#39;sessionOrUserType&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;sessionOrUser&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;state&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;givenAt&#39;</span><span class="token punctuation">]</span> <span class="token punctuation">}</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Here the “owner” is session-or-user plus <strong>giver</strong> (giverType, giver), so you can list “my received cards” or “my received cards by giver”.</p>`,17)]))}const c=n(p,[["render",o]]),l=JSON.parse('{"path":"/server/09-04-sessionOrUserProperty-sessionOrUserItem.html","title":"sessionOrUserProperty and sessionOrUserItem","lang":"en-US","frontmatter":{"title":"sessionOrUserProperty and sessionOrUserItem"},"headers":[{"level":2,"title":"sessionOrUserProperty","slug":"sessionoruserproperty","link":"#sessionoruserproperty","children":[{"level":3,"title":"Configuration","slug":"configuration","link":"#configuration","children":[]}]},{"level":2,"title":"sessionOrUserItem","slug":"sessionoruseritem","link":"#sessionoruseritem","children":[{"level":3,"title":"Configuration","slug":"configuration-1","link":"#configuration-1","children":[]}]},{"level":2,"title":"Example: ReceivedCard (sessionOrUserProperty with extendedWith)","slug":"example-receivedcard-sessionoruserproperty-with-extendedwith","link":"#example-receivedcard-sessionoruserproperty-with-extendedwith","children":[]}],"git":{"updatedTime":1771163669000,"contributors":[{"name":"Michał Łaszczewski","username":"","email":"michal@laszczewski.com","commits":1}],"changelog":[{"hash":"cfc969ff1ce8a43846182cb1c9818f3c88cd885a","time":1771163669000,"email":"michal@laszczewski.com","author":"Michał Łaszczewski","message":"docs"}]},"filePathRelative":"server/09-04-sessionOrUserProperty-sessionOrUserItem.md"}');export{c as comp,l as data};
