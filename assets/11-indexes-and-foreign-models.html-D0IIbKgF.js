import{_ as s,c as a,e,o as p}from"./app-CdUme-sL.js";const t={};function i(o,n){return p(),a("div",null,n[0]||(n[0]=[e(`<h1 id="indexes-and-foreign-models" tabindex="-1"><a class="header-anchor" href="#indexes-and-foreign-models"><span>Indexes and foreign models</span></a></h1><p><strong>Indexes</strong> on models enable efficient range and lookup views. <strong>Foreign models</strong> let one service reference entities from another service (e.g. user Identification from userIdentification service) and use them in views or simple queries.</p><h2 id="indexes-on-a-model" tabindex="-1"><a class="header-anchor" href="#indexes-on-a-model"><span>Indexes on a model</span></a></h2><p>Define <strong>indexes</strong> in <strong>definition.model({ indexes: { ... } })</strong>. Each index has a <strong>property</strong> (single key or array of keys) and optionally <strong>multi: true</strong> for multi-value keys (e.g. participants).</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code><span class="line"><span class="token comment">// Source: speed-dating/server/business-card-service/card.js</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">const</span> ReceivedCard <span class="token operator">=</span> definition<span class="token punctuation">.</span><span class="token function">model</span><span class="token punctuation">(</span><span class="token punctuation">{</span></span>
<span class="line">  <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&quot;ReceivedCard&quot;</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token comment">// ...</span></span>
<span class="line">  <span class="token literal-property property">indexes</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token literal-property property">byOwnerAndStateAndTime</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token literal-property property">property</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&#39;sessionOrUserType&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;sessionOrUser&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;state&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;givenAt&#39;</span><span class="token punctuation">]</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code><span class="line"><span class="token comment">// Source: ipi-web/scan/server/scan-service/model.js</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">const</span> Transaction <span class="token operator">=</span> definition<span class="token punctuation">.</span><span class="token function">model</span><span class="token punctuation">(</span><span class="token punctuation">{</span></span>
<span class="line">  <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&#39;Transaction&#39;</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token literal-property property">properties</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token operator">...</span> <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token literal-property property">indexes</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token literal-property property">byTime</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">property</span><span class="token operator">:</span> <span class="token string">&#39;time&#39;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token literal-property property">byHash</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">property</span><span class="token operator">:</span> <span class="token string">&#39;hash&#39;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token literal-property property">byParticipants</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">property</span><span class="token operator">:</span> <span class="token string">&#39;participants&#39;</span><span class="token punctuation">,</span> <span class="token literal-property property">multi</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token literal-property property">byAccSequence</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">property</span><span class="token operator">:</span> <span class="token string">&#39;accSequence&#39;</span><span class="token punctuation">,</span> <span class="token literal-property property">multi</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token comment">// ...</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="using-indexes-in-views" tabindex="-1"><a class="header-anchor" href="#using-indexes-in-views"><span>Using indexes in views</span></a></h2><ul><li><strong>Model.rangePath(range)</strong> — Full range over the model (primary order).</li><li><strong>Model.path(id)</strong> — Single entity by id.</li><li><strong>Model.sortedIndexRangePath(indexName, keyPrefix, range)</strong> — Range over an index; keyPrefix is the prefix of the index key (e.g. [sessionOrUserType, sessionOrUser, state] for byOwnerAndStateAndTime).</li><li><strong>Model.indexObjectPath(indexName, key)</strong> — Single object by exact index key.</li><li><strong>Model.indexObjectPath(indexName, keyPrefix, { limit, reverse })</strong> — One object from index (e.g. last by participants).</li></ul><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code><span class="line"><span class="token comment">// Source: speed-dating/server/business-card-service/card.js</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">return</span> ReceivedCard<span class="token punctuation">.</span><span class="token function">sortedIndexRangePath</span><span class="token punctuation">(</span><span class="token string">&#39;byOwnerAndStateAndTime&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span></span>
<span class="line">  sessionOrUserType<span class="token punctuation">,</span> sessionOrUser<span class="token punctuation">,</span></span>
<span class="line">  state</span>
<span class="line"><span class="token punctuation">]</span><span class="token punctuation">,</span> range<span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code><span class="line"><span class="token comment">// Source: ipi-web/scan/server/scan-service/view.js</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">return</span> Transaction<span class="token punctuation">.</span><span class="token function">indexObjectPath</span><span class="token punctuation">(</span><span class="token string">&#39;byHash&#39;</span><span class="token punctuation">,</span> props<span class="token punctuation">.</span>hash<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">return</span> Transaction<span class="token punctuation">.</span><span class="token function">sortedIndexRangePath</span><span class="token punctuation">(</span><span class="token string">&#39;byParticipants&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>props<span class="token punctuation">.</span>participant<span class="token punctuation">]</span><span class="token punctuation">,</span> App<span class="token punctuation">.</span><span class="token function">extractRange</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">return</span> Transaction<span class="token punctuation">.</span><span class="token function">indexObjectPath</span><span class="token punctuation">(</span><span class="token string">&#39;byParticipants&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>props<span class="token punctuation">.</span>participant<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">limit</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token literal-property property">reverse</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="foreign-models" tabindex="-1"><a class="header-anchor" href="#foreign-models"><span>Foreign models</span></a></h2><p>Use <strong>definition.foreignModel(serviceName, modelName)</strong> to reference a model from another service. You get a proxy that supports path/index access for use in views or in simple-query sources.</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code><span class="line"><span class="token comment">// Source: speed-dating/server/business-card-service/card.js</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">const</span> Identification <span class="token operator">=</span> definition<span class="token punctuation">.</span><span class="token function">foreignModel</span><span class="token punctuation">(</span><span class="token string">&#39;userIdentification&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;Identification&#39;</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Then use <strong>Identification</strong> in a simple-query <strong>sources</strong> map or in view logic that needs to read from the userIdentification service.</p><h2 id="block-and-custom-paths-scan" tabindex="-1"><a class="header-anchor" href="#block-and-custom-paths-scan"><span>Block and custom paths (scan)</span></a></h2><p>When the path is not a simple model path or index path, define helpers (e.g. blockId, blockTransactionsPath) and use them in daoPath:</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code><span class="line"><span class="token comment">// Source: ipi-web/scan/server/scan-service/view.js</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">return</span> Block<span class="token punctuation">.</span><span class="token function">path</span><span class="token punctuation">(</span><span class="token function">blockId</span><span class="token punctuation">(</span>props<span class="token punctuation">.</span>height<span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">return</span> <span class="token function">blockTransactionsPath</span><span class="token punctuation">(</span>props<span class="token punctuation">.</span>height<span class="token punctuation">,</span> App<span class="token punctuation">.</span><span class="token function">extractRange</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>These helpers return DAO paths that the framework resolves to the correct range or object.</p>`,18)]))}const c=s(t,[["render",i]]),r=JSON.parse('{"path":"/server/11-indexes-and-foreign-models.html","title":"Indexes and foreign models","lang":"en-US","frontmatter":{"title":"Indexes and foreign models"},"headers":[{"level":2,"title":"Indexes on a model","slug":"indexes-on-a-model","link":"#indexes-on-a-model","children":[]},{"level":2,"title":"Using indexes in views","slug":"using-indexes-in-views","link":"#using-indexes-in-views","children":[]},{"level":2,"title":"Foreign models","slug":"foreign-models","link":"#foreign-models","children":[]},{"level":2,"title":"Block and custom paths (scan)","slug":"block-and-custom-paths-scan","link":"#block-and-custom-paths-scan","children":[]}],"git":{"updatedTime":1771163669000,"contributors":[{"name":"Michał Łaszczewski","username":"","email":"michal@laszczewski.com","commits":1}],"changelog":[{"hash":"cfc969ff1ce8a43846182cb1c9818f3c88cd885a","time":1771163669000,"email":"michal@laszczewski.com","author":"Michał Łaszczewski","message":"docs"}]},"filePathRelative":"server/11-indexes-and-foreign-models.md"}');export{c as comp,r as data};
