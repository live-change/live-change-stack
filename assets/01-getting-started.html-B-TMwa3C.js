import{_ as n,c as a,e,o as t}from"./app-CdUme-sL.js";const p={};function o(c,s){return t(),a("div",null,s[0]||(s[0]=[e(`<h1 id="getting-started" tabindex="-1"><a class="header-anchor" href="#getting-started"><span>Getting started</span></a></h1><p>The server entry point is a single script (typically <code>server/start.js</code>) that loads app config, wires service modules from a services list, and calls the CLI <strong>starter</strong>. The starter parses command-line arguments and runs the appropriate mode (dev, ssrDev, apiServer, withDb, withServices, etc.).</p><h2 id="entry-flow" tabindex="-1"><a class="header-anchor" href="#entry-flow"><span>Entry flow</span></a></h2><ol><li>Load <code>app.config.js</code> (services array, clientConfig, optional remote).</li><li>Load <code>services.list.js</code> and assign each <code>serviceConfig.module = services[serviceConfig.name]</code>.</li><li>Set <code>appConfig.init</code> to the init function if present.</li><li>Optionally read <code>package.json</code> for name, version, homepage and merge into <code>clientConfig</code>.</li><li>Call <code>starter(appConfig, {}, { version })</code> from <code>@live-change/cli</code>.</li></ol><h2 id="example-start-js-speed-dating-family-tree" tabindex="-1"><a class="header-anchor" href="#example-start-js-speed-dating-family-tree"><span>Example: start.js (speed-dating / family-tree)</span></a></h2><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code><span class="line"><span class="token comment">// Source: speed-dating/server/start.js (same pattern in family-tree/server/start.js)</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">import</span> appConfig <span class="token keyword">from</span> <span class="token string">&#39;./app.config.js&#39;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> services <span class="token keyword">from</span> <span class="token string">&#39;./services.list.js&#39;</span></span>
<span class="line"><span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">const</span> serviceConfig <span class="token keyword">of</span> appConfig<span class="token punctuation">.</span>services<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  serviceConfig<span class="token punctuation">.</span>module <span class="token operator">=</span> services<span class="token punctuation">[</span>serviceConfig<span class="token punctuation">.</span>name<span class="token punctuation">]</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line">appConfig<span class="token punctuation">.</span>init <span class="token operator">=</span> services<span class="token punctuation">[</span><span class="token string">&#39;init&#39;</span><span class="token punctuation">]</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> fileURLToPath <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;url&#39;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> dirname<span class="token punctuation">,</span> join <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;path&#39;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> accessSync<span class="token punctuation">,</span> readFileSync <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;fs&#39;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">const</span> packageJsonPath <span class="token operator">=</span> <span class="token function">dirname</span><span class="token punctuation">(</span><span class="token function">fileURLToPath</span><span class="token punctuation">(</span><span class="token keyword">import</span><span class="token punctuation">.</span>meta<span class="token punctuation">.</span>url<span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">  <span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">&#39;/&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">part<span class="token punctuation">,</span> i<span class="token punctuation">,</span> arr</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span></span>
<span class="line">    <span class="token function">join</span><span class="token punctuation">(</span>arr<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> arr<span class="token punctuation">.</span>length <span class="token operator">-</span> i<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">&#39;/&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&#39;package.json&#39;</span><span class="token punctuation">)</span></span>
<span class="line">  <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token parameter">p</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> <span class="token keyword">try</span> <span class="token punctuation">{</span> <span class="token function">accessSync</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">return</span> <span class="token boolean">true</span> <span class="token punctuation">}</span> <span class="token keyword">catch</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token boolean">false</span> <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">const</span> packageJson <span class="token operator">=</span> packageJsonPath <span class="token operator">?</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token function">readFileSync</span><span class="token punctuation">(</span>packageJsonPath<span class="token punctuation">,</span> <span class="token string">&#39;utf-8&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">const</span> name <span class="token operator">=</span> packageJson<span class="token punctuation">.</span>name <span class="token operator">??</span> <span class="token string">&quot;Example&quot;</span></span>
<span class="line"><span class="token keyword">const</span> brandName <span class="token operator">=</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">BRAND_NAME</span> <span class="token operator">||</span> <span class="token punctuation">(</span>name<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">toUpperCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> name<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">const</span> homepage <span class="token operator">=</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">BASE_HREF</span> <span class="token operator">??</span> packageJson<span class="token punctuation">.</span>homepage</span>
<span class="line"><span class="token keyword">const</span> baseHref <span class="token operator">=</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">BASE_HREF</span> <span class="token operator">||</span> homepage <span class="token operator">||</span> <span class="token string">&#39;http://localhost:8001&#39;</span></span>
<span class="line"><span class="token keyword">const</span> version <span class="token operator">=</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">VERSION</span> <span class="token operator">||</span> packageJson<span class="token punctuation">.</span>version</span>
<span class="line"></span>
<span class="line">appConfig<span class="token punctuation">.</span>clientConfig <span class="token operator">=</span> <span class="token punctuation">{</span></span>
<span class="line">  version<span class="token punctuation">,</span></span>
<span class="line">  name<span class="token punctuation">,</span> brandName<span class="token punctuation">,</span> brandDomain<span class="token punctuation">,</span> homepage<span class="token punctuation">,</span> baseHref<span class="token punctuation">,</span></span>
<span class="line">  <span class="token operator">...</span>appConfig<span class="token punctuation">.</span>clientConfig</span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> starter <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;@live-change/cli&#39;</span></span>
<span class="line"></span>
<span class="line"><span class="token function">starter</span><span class="token punctuation">(</span>appConfig<span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> version <span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="cli-commands-starter" tabindex="-1"><a class="header-anchor" href="#cli-commands-starter"><span>CLI commands (starter)</span></a></h2><p>The starter registers commands such as:</p><table><thead><tr><th>Command</th><th>Description</th></tr></thead><tbody><tr><td><code>apiServer</code></td><td>API server only (WebSocket/SockJS).</td></tr><tr><td><code>devApiServer</code></td><td>Like apiServer with <code>--withServices --updateServices</code>.</td></tr><tr><td><code>memApiServer</code></td><td>devApiServer + <code>--withDb --dbBackend mem --createDb</code>.</td></tr><tr><td><code>dev</code></td><td>API server + services (dev).</td></tr><tr><td><code>ssrDev</code></td><td>SSR dev server (Vite).</td></tr><tr><td><code>localDev</code> / <code>localDevInit</code></td><td>Local dev with DB; init can run <code>--initScript ./init.js</code>.</td></tr><tr><td><code>memDev</code></td><td>In-memory DB dev with optional <code>--initScript</code>, <code>--dbAccess</code>.</td></tr><tr><td><code>ssrServer</code></td><td>Production SSR server; use <code>--withApi --withServices --updateServices</code> to run API and services in same process.</td></tr><tr><td><code>serve</code></td><td>Production serve (SSR) without extra services.</td></tr></tbody></table><h2 id="environment-variables" tabindex="-1"><a class="header-anchor" href="#environment-variables"><span>Environment variables</span></a></h2><p>Common defaults (from <code>@live-change/server</code> / starter):</p><ul><li><code>API_SERVER_HOST</code> / <code>API_SERVER_PORT</code> (default 8002) — API server bind.</li><li><code>SSR_SERVER_HOST</code> / <code>SSR_SERVER_PORT</code> (default 8001) — SSR server bind.</li><li><code>SESSION_COOKIE_DOMAIN</code> — Cookie domain for session.</li><li><code>DB_NAME</code> — Database name (e.g. used by setupApp).</li><li><code>CONTEXT_POOL_SIZE</code>, <code>MAX_QUEUE_SIZE</code>, <code>RENDER_TIMEOUT</code>, <code>CONTEXT_MAX_USES</code> — SSR context pool.</li><li><code>withDb</code> / <code>dbBackend</code> / <code>dbRoot</code> / <code>createDb</code> / <code>dbAccess</code> — Database options when using CLI flags.</li></ul><h2 id="package-json-scripts-example" tabindex="-1"><a class="header-anchor" href="#package-json-scripts-example"><span>package.json scripts example</span></a></h2><div class="language-json line-numbers-mode" data-highlighter="prismjs" data-ext="json"><pre><code><span class="line"><span class="token comment">// Typical scripts (e.g. family-tree/package.json)</span></span>
<span class="line"><span class="token property">&quot;localDevInit&quot;</span><span class="token operator">:</span> <span class="token string">&quot;tsx server/start.js localDev --enableSessions --initScript ./init.js --dbAccess&quot;</span><span class="token punctuation">,</span></span>
<span class="line"><span class="token property">&quot;dev&quot;</span><span class="token operator">:</span> <span class="token string">&quot;tsx --inspect server/start.js dev --enableSessions&quot;</span><span class="token punctuation">,</span></span>
<span class="line"><span class="token property">&quot;ssrDev&quot;</span><span class="token operator">:</span> <span class="token string">&quot;tsx server/start.js ssrDev --enableSessions&quot;</span><span class="token punctuation">,</span></span>
<span class="line"><span class="token property">&quot;serveAll&quot;</span><span class="token operator">:</span> <span class="token string">&quot;cross-env NODE_ENV=production node dist/server/start.js ssrServer --withApi --withServices --updateServices --enableSessions&quot;</span><span class="token punctuation">,</span></span>
<span class="line"><span class="token property">&quot;apiServer&quot;</span><span class="token operator">:</span> <span class="token string">&quot;node dist/server/start.js apiServer --enableSessions&quot;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,14)]))}const l=n(p,[["render",o]]),r=JSON.parse('{"path":"/server/01-getting-started.html","title":"Getting started","lang":"en-US","frontmatter":{"title":"Getting started"},"headers":[{"level":2,"title":"Entry flow","slug":"entry-flow","link":"#entry-flow","children":[]},{"level":2,"title":"Example: start.js (speed-dating / family-tree)","slug":"example-start-js-speed-dating-family-tree","link":"#example-start-js-speed-dating-family-tree","children":[]},{"level":2,"title":"CLI commands (starter)","slug":"cli-commands-starter","link":"#cli-commands-starter","children":[]},{"level":2,"title":"Environment variables","slug":"environment-variables","link":"#environment-variables","children":[]},{"level":2,"title":"package.json scripts example","slug":"package-json-scripts-example","link":"#package-json-scripts-example","children":[]}],"git":{"updatedTime":1771163669000,"contributors":[{"name":"Michał Łaszczewski","username":"","email":"michal@laszczewski.com","commits":1}],"changelog":[{"hash":"cfc969ff1ce8a43846182cb1c9818f3c88cd885a","time":1771163669000,"email":"michal@laszczewski.com","author":"Michał Łaszczewski","message":"docs"}]},"filePathRelative":"server/01-getting-started.md"}');export{l as comp,r as data};
