import{_ as s,c as e,e as a,o as t}from"./app-CdUme-sL.js";const r={};function o(i,n){return t(),e("div",null,n[0]||(n[0]=[a(`<h1 id="email-and-sms" tabindex="-1"><a class="header-anchor" href="#email-and-sms"><span>Email and SMS</span></a></h1><p>Sending email and SMS is done by calling <strong>triggers</strong> on <strong>email-service</strong> and <strong>phone-service</strong>: <strong>sendEmailMessage</strong> and <strong>sendPhoneMessage</strong>. You pass a <strong>message</strong> id (for idempotency/logging), <strong>content</strong> (to, text, etc.), and optionally <strong>render</strong> so the service can render the body from a template. Rendering is often done in the <strong>frontend</strong> (browser) or in a shared render function; the server only receives the final content or render parameters. This section does not describe email/SMS template formats in detail.</p><h2 id="sending-email" tabindex="-1"><a class="header-anchor" href="#sending-email"><span>Sending email</span></a></h2><p>Add <strong>email</strong> service to app.config. From your code (trigger or action), call:</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code><span class="line"><span class="token keyword">await</span> <span class="token function">triggerService</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">service</span><span class="token operator">:</span> <span class="token string">&#39;email&#39;</span><span class="token punctuation">,</span> <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&#39;sendEmailMessage&#39;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token literal-property property">message</span><span class="token operator">:</span> messageId<span class="token punctuation">,</span>   <span class="token comment">// optional; generated if omitted</span></span>
<span class="line">  <span class="token literal-property property">email</span><span class="token operator">:</span> content<span class="token punctuation">,</span>       <span class="token comment">// { to, text, subject?, html?, ... } (nodemailer-compatible)</span></span>
<span class="line">  <span class="token literal-property property">render</span><span class="token operator">:</span> <span class="token keyword">undefined</span>     <span class="token comment">// optional: { ... } passed to email-service render</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>If <strong>render</strong> is provided, the email service calls its <strong>renderEmail({ client, ...render })</strong> to produce <strong>content</strong> (e.g. from a template and locale). Otherwise <strong>content</strong> must be provided with at least <strong>to</strong> and <strong>text</strong>. The service then uses nodemailer (config.smtp) to send and emits <strong>sent</strong> or <strong>error</strong> events (stored in SentEmail model).</p><h2 id="sending-sms" tabindex="-1"><a class="header-anchor" href="#sending-sms"><span>Sending SMS</span></a></h2><p>Add <strong>phone</strong> service to app.config. From your code:</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code><span class="line"><span class="token keyword">await</span> <span class="token function">triggerService</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">service</span><span class="token operator">:</span> <span class="token string">&#39;phone&#39;</span><span class="token punctuation">,</span> <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&#39;sendPhoneMessage&#39;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token literal-property property">message</span><span class="token operator">:</span> messageId<span class="token punctuation">,</span></span>
<span class="line">  <span class="token literal-property property">content</span><span class="token operator">:</span> <span class="token punctuation">{</span> text<span class="token punctuation">,</span> to<span class="token punctuation">,</span> from <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token literal-property property">render</span><span class="token operator">:</span> <span class="token keyword">undefined</span>     <span class="token comment">// optional: passed to phone-service renderSms</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>If <strong>render</strong> is set, the phone service uses <strong>renderSms(render)</strong> to produce content. Otherwise <strong>content</strong> must have <strong>text</strong> and <strong>to</strong>. The service uses the configured provider (e.g. SMSAPI) to send and emits <strong>sent</strong> or <strong>error</strong> (stored in SentSms model).</p><h2 id="rendering" tabindex="-1"><a class="header-anchor" href="#rendering"><span>Rendering</span></a></h2><ul><li><strong>Email</strong>: The email-service <strong>render</strong> parameter is typically used to pass template name and variables; the actual HTML/text rendering may be implemented in the service (e.g. render.js) or prepared by the frontend and sent as ready <strong>content</strong>. This manual does not specify template syntax or layout.</li><li><strong>SMS</strong>: Similarly, <strong>render</strong> can drive template-based text; details of templates are not covered here.</li></ul><h2 id="configuration" tabindex="-1"><a class="header-anchor" href="#configuration"><span>Configuration</span></a></h2><ul><li><strong>email-service</strong>: Configure <strong>smtp</strong> (e.g. in config.js or definition.config) for nodemailer transport.</li><li><strong>phone-service</strong>: Configure provider (e.g. <strong>accessToken</strong> or env <strong>SMSAPI_ACCESS_TOKEN</strong> for SMSAPI), and <strong>from</strong> for sender id where applicable.</li></ul><p>Test addresses (e.g. @test.com for email, a test number for SMS) are often handled by the service without actually sending (log only and emit sent).</p>`,15)]))}const l=s(r,[["render",o]]),c=JSON.parse('{"path":"/server/17-email-and-sms.html","title":"Email and SMS","lang":"en-US","frontmatter":{"title":"Email and SMS"},"headers":[{"level":2,"title":"Sending email","slug":"sending-email","link":"#sending-email","children":[]},{"level":2,"title":"Sending SMS","slug":"sending-sms","link":"#sending-sms","children":[]},{"level":2,"title":"Rendering","slug":"rendering","link":"#rendering","children":[]},{"level":2,"title":"Configuration","slug":"configuration","link":"#configuration","children":[]}],"git":{"updatedTime":1771163669000,"contributors":[{"name":"Michał Łaszczewski","username":"","email":"michal@laszczewski.com","commits":1}],"changelog":[{"hash":"cfc969ff1ce8a43846182cb1c9818f3c88cd885a","time":1771163669000,"email":"michal@laszczewski.com","author":"Michał Łaszczewski","message":"docs"}]},"filePathRelative":"server/17-email-and-sms.md"}');export{l as comp,c as data};
